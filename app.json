{
    "extends": [
        "github>mailerlite/renovate-config:base"
    ],
    "enabledManagers": [
        "regex",
        "docker-compose",
        "helmv3",
        "github-actions"
    ],
    "customManagers": [
        {
            "customType": "regex",
            "fileMatch": ["(^|\/|.)Dockerfile$"],
            "matchStrings": [
                "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)( extractVersion=(?<extractVersion>.+?))?( versioning=(?<versioning>.*?))?\n.*?_VERSION=[\"]?(?<currentValue>.*[^\"\\n])"
            ],
            "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
        },
        {
            "customType": "regex",
            "fileMatch": ["(^|\/|.)Dockerfile$"],
            "matchStrings": [
                "FROM (?:.*?\/mailergroup\/)(?<depName>[a-z0-9.\/-]+)(?::(?<currentValue>[a-z0-9.-]+))?"
            ],
            "datasourceTemplate": "docker"
        },
        {
            "customType": "regex",
            "fileMatch": ["(?:helm|helmchart)/values.(?:dev|prod|staging|production).(?:yaml|yml)"],
            "matchStrings": [
                "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)?\n.*?image: .*?:(?<currentValue>.*)"
            ],
            "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
        }
    ],
    "packageRules": [
        {
            "description": "Internal Octopus/Swiss-army-knife registry",
            "matchPackagePatterns": ["octopus", "swiss-army-knife"],
            "registryUrls": ["https://europe-docker.pkg.dev/mailergroup/"]
        },
        {
            "description": "Landings registry",
            "matchPackagePatterns": ["europe-docker.pkg.dev/mailerlite-v2/landings/landings"],
            "registryUrls": ["https://europe-docker.pkg.dev/mailerlite-v2/"]
        },
        {
            "description": "Docker images - separate PRs per package",
            "matchDatasources": ["docker"],
            "addLabels": ["docker"],
            "reviewers": ["team:sre"],
            "schedule": ["* 23,0,1 * * 1-5"]
        },
        {
            "description": "GitHub Actions - separate PRs per package",
            "matchDatasources": ["github-actions"],
            "addLabels": ["github"],
            "reviewers": ["team:sre"],
            "schedule": ["* 22-23,0-2 * * 1-5"]
        },
        {
            "description": "Elasticsearch - allow patch/minor",
            "matchPackagePatterns": ["elasticsearch"],
            "matchUpdateTypes": ["patch", "minor"]
        },
        {
            "description": "Elasticsearch - disable major updates",
            "matchPackagePatterns": ["elasticsearch"],
            "matchUpdateTypes": ["major"],
            "enabled": false
        },
        {
            "description": "Helm charts - separate PRs per package",
            "matchDatasources": ["helm"],
            "addLabels": ["helm"],
            "reviewers": ["team:sre"],
            "schedule": ["* 21-23,0-3 * * 1-5"]
        },
        {
            "description": "GitHub releases - separate PRs per package",
            "matchDatasources": ["github-releases"],
            "reviewers": ["team:sre"],
            "schedule": ["* 20-23,0-4 * * 1-5"]
        }
    ]
}
